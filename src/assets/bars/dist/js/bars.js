(()=>{"use strict";var t={973:(t,e,s)=>{s.r(e)},357:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NeoBatchActionBar=e.MatrixBatchActionBar=e.BatchActionBar=void 0;class s{constructor(t,e){this.input=t,this.settings=e,this._$buttons={},this.$bar=$('<div class="batch-action-bar"/>').prependTo(t.$container),this._initSelect(),this._initButtons(),this._initMenu();const s=this.$bar.add(this.$menu);this.supportedActions().forEach((([t,e,n])=>{const i=t.toLowerCase();this._$buttons[i]=s.find(`[data-bba-bn="button.${i}"]`),this._$buttons[i].on("activate",(t=>{t.preventDefault();const e=this[i];"function"==typeof e&&(e.bind(this)(),this.refreshButtons())}))})),this.refreshButtons(),this.registerEventListeners()}supportedActions(){return[["Expand","expand",this.isBlockCollapsed.bind(this)],["Collapse","collapse",this.isBlockExpanded.bind(this)],["Enable","enabled",this.isBlockDisabled.bind(this)],["Disable","disabled",this.isBlockEnabled.bind(this)],["Delete","remove",t=>!0]]}isBlockCollapsed(t){return!this.isBlockExpanded(t)}isBlockDisabled(t){return!this.isBlockEnabled(t)}_initSelect(){this.$selectContainer=$("<div/>",{class:"batch-action-bar_select",role:"checkbox",tabindex:0,"aria-label":Craft.t("batch-actions","Select all"),"aria-checked":"false"}).appendTo(this.$bar),this.$select=$('<div class="checkbox">').appendTo(this.$selectContainer);let t=!1,e=!1;const s=s=>{e||(this.input.on(this.settings.addBlockEvent,(e=>{var s;const n=null!==(s=e.$block)&&void 0!==s?s:e.block.$container;this.$select.hasClass("checked")&&(t=!0,n.addClass(this.input.blockSelect.settings.selectedClass),this.input.blockSelect.selectItem(n,!1,!0),this.refreshButtons())})),e=!0),t=!0,this.$select.toggleClass("checked").removeClass("indeterminate"),this.$select.hasClass("checked")?(this.input.blockSelect.selectAll(),this.$selectContainer.attr("aria-checked","true")):(this.input.blockSelect.deselectAll(),this.$selectContainer.attr("aria-checked","false"))};this.$selectContainer.on("mousedown",(t=>{t.which===Garnish.PRIMARY_CLICK&&s()})),this.$selectContainer.on("keydown",(t=>{t.keyCode===Garnish.SPACE_KEY&&(t.preventDefault(),s())})),this.input.blockSelect.on("selectionChange",(e=>{if(t)t=!1;else{this.$select.removeClass("checked");const t=this.input.blockSelect.$selectedItems.length>0;this.$select.toggleClass("indeterminate",t),this.$selectContainer.attr("aria-checked",t?"mixed":"false")}this.refreshButtons()}))}refreshButtons(){const t={},e=[];this.supportedActions().forEach((([s,n,i])=>{e.push(s),t[s]={icon:n,check:i,enable:!1}})),this.input.blockSelect.$selectedItems.each(((s,n)=>{const i=$(n);e.forEach((e=>{var s;(s=t[e]).enable||(s.enable=t[e].check(i))}))})),e.forEach((e=>{this._$buttons[e.toLowerCase()].toggleClass("disabled",!t[e].enable)}))}registerEventListeners(){}_initButtons(){this.$buttonsContainer=$('<div class="batch-action-bar_buttons btngroup"/>').appendTo(this.$bar),this.supportedActions().forEach((([t,e,s])=>this._generateAction(t,e,"btn").appendTo(this.$buttonsContainer)))}_initMenu(){this.$menuContainer=$('<div class="batch-action-bar_menu hidden"/>').appendTo(this.$bar);const t=$('<button type="button" class="btn settings icon menubtn">Actions</button>').appendTo(this.$menuContainer);this.$menu=$('<div class="menu"/>').appendTo(this.$menuContainer);const e=$('<ul class="padded"/>').appendTo(this.$menu);this.supportedActions().forEach((([t,s])=>$("<li/>").append(this._generateAction(t,s)).appendTo(e))),t.menubtn();const s=this.$selectContainer.outerWidth()+2;let n=this.$buttonsContainer.width();this.$bar.on("resize",(()=>{n||(n=this.$buttonsContainer.width());const t=this.$bar.width()-s<n;this.$buttonsContainer.toggleClass("hidden",t),this.$menuContainer.toggleClass("hidden",!t)}))}_generateAction(t,e,s){const n=void 0!==s,i=t.toLowerCase();null!=e||(e=i);const o=$(`<${n?"button":"a"}/>`).attr({"aria-label":t,"data-bba-bn":`button.${i}`,"data-icon":e}).text(Craft.t("batch-actions",t));return n&&o.addClass(s),o}expand(){this.getSelectedBlocks().forEach((t=>t.expand()))}collapse(){this.getSelectedBlocks().forEach((t=>t.collapse()))}}e.BatchActionBar=s,e.MatrixBatchActionBar=class extends s{constructor(t){super(t,{addBlockEvent:"blockAdded"}),this.input=t}registerEventListeners(){const t=t=>{t.actionDisclosure.on("hide",(()=>this.refreshButtons()))};this.input.blockSelect.$items.each(((e,s)=>t($(s).data("block")))),this.input.on(this.settings.addBlockEvent,(e=>{setTimeout((()=>{var s;return t(null===(s=e.$block)||void 0===s?void 0:s.data("block"))}),250)}))}isBlockExpanded(t){return!t.hasClass("collapsed")}isBlockEnabled(t){return!t.hasClass("disabled")}getSelectedBlocks(){return this.input.blockSelect.$selectedItems.map(((t,e)=>$(e).data("block"))).get()}enable(){this.getSelectedBlocks().forEach((t=>t.enable()))}disable(){this.getSelectedBlocks().forEach((t=>t.disable()))}delete(){window.confirm(Craft.t("batch-actions","Are you sure you want to delete the selected blocks?"))&&this.getSelectedBlocks().forEach((t=>t.selfDestruct()))}},e.NeoBatchActionBar=class extends s{constructor(t){super(t,{addBlockEvent:"addBlock"}),this.input=t}supportedActions(){return super.supportedActions().concat([["Copy","field",()=>this.getSelectedBlocks().length>0]])}registerEventListeners(){const t=t=>{t.on("toggleExpansion toggleEnabled",(()=>this.refreshButtons()))};this.input.getBlocks().forEach(t),this.input.on(this.settings.addBlockEvent,(e=>t(e.block))),this.input.on("removeBlock",(()=>this.refreshButtons()))}isBlockExpanded(t){return t.hasClass("is-expanded")}isBlockEnabled(t){return t.hasClass("is-enabled")}getSelectedBlocks(){return this.input.getBlocks().filter((t=>t.isSelected()))}enable(){var t;null===(t=this.getSelectedBlocks().find((t=>!t.isEnabled())))||void 0===t||t.enable()}disable(){var t;null===(t=this.getSelectedBlocks().find((t=>t.isEnabled())))||void 0===t||t.disable()}delete(){window.confirm(Craft.t("batch-actions","Are you sure you want to delete the selected blocks?"))&&this.getSelectedBlocks().forEach((t=>this.input.removeBlock(t)))}copy(){const t=this.getSelectedBlocks();t.length>0&&this.input["@copyBlock"]({block:t[0]})}}}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,s),o.exports}s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=s(357);s(973);const e=[],n=[];let i=!1,o={barsDisallowedFields:[]};window.BatchActions={initBars:t=>{o=t,n.forEach((t=>t())),i=!0},bars:()=>Array.from(e)},void 0!==Craft.MatrixInput&&Garnish.on(Craft.MatrixInput,"afterInit",(s=>{const a=s.target.$container.closest("[data-type=craft\\\\fields\\\\Matrix]").data("attribute"),c=()=>{o.barsDisallowedFields.includes(a)||e.push(new t.MatrixBatchActionBar(s.target))};i?c():n.push(c)})),"undefined"!=typeof Neo&&void 0!==Neo.Input&&Garnish.on(Neo.Input,"afterInit",(s=>{if(void 0!==s.target.blockSelect){const a=s.target.getName(),c=()=>{o.barsDisallowedFields.includes(a)||e.push(new t.NeoBatchActionBar(s.target))};i?c():n.push(c)}}))})()})();
//# sourceMappingURL=bars.js.map